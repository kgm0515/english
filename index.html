<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>English Learn</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- ËØçÊ±áÊï∞ÊçÆ -->
    <script src="./api/middle-school-vocabulary.js"></script>
  </head>
  <body>
    <div
      id="app"
      class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-8 relative"
    >
      <!-- ËÉåÊôØË£ÖÈ•∞ -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none h-full">
        <div
          class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-25 animate-blob"
        ></div>
        <div
          class="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-300 rounded-full mix-blend-multiply filter blur-xl opacity-25 animate-blob animation-delay-2000"
        ></div>
        <div
          class="absolute top-40 right-1/2 w-96 h-96 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-1000"
        ></div>
        <div
          class="absolute -top-20 left-1/4 w-72 h-72 bg-cyan-300 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-3000"
        ></div>
      </div>

      <!-- Ê†áÈ¢òÂå∫Âüü - Âê∏È°∂ -->
      <div
        class="sticky top-0 z-20 pt-4 pb-4 transition-all duration-300"
        :class="isSticky ? 'backdrop-blur-lg bg-white/30 shadow-lg border-b border-slate-200/50 ' : ''"
      >
        <div class="container mx-auto px-4">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <h1
              class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-indigo-600 to-blue-600 bg-clip-text text-transparent"
            >
              Ëã±ËØ≠ÂçïËØçÂ≠¶‰π†
            </h1>
            <!-- ËØçÊ±áË°®ÈÄâÊã©Âô® -->
            <select
              v-model="currentVocabularySet"
              @change="switchVocabularySet()"
              class="py-2 pl-3 pr-9 bg-white rounded-lg text-sm border border-slate-200 hover:border-indigo-300 hover:shadow-sm transition-all focus:outline-none focus:ring-2 focus:ring-indigo-400/50 text-slate-700 shadow-sm flex-shrink-0"
            >
              <option
                v-for="set in vocabularySets"
                :key="set.value"
                :value="set.value"
                class="text-gray-900"
              >
                {{ set.label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <div class="container mx-auto px-4 relative z-10">
        <!-- Á≠õÈÄâÊåâÈíÆÁªÑ - ‰∏çÂê∏È°∂ -->
        <div class="mb-6 flex justify-end">
          <div
            class="flex items-center overflow-x-auto bg-white shadow-md hover:shadow-lg hover:border-indigo-300 transition-all scrollbar-hide"
          >
            <!-- <button
              @click="filterType = 'all'"
              class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium transition-all"
              :class="filterType === 'all' ? 'bg-white/25 text-white' : 'hover:bg-white/15'"
            >
              <span class="w-1.5 h-1.5 rounded-full bg-white/60"></span>
              ÂÖ®ÈÉ® {{ wordList.length }}
            </button> -->
            <button
              @click="filterType = 'not-learned'"
              class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium transition-all text-slate-600"
              :class="filterType === 'not-learned' ? 'bg-gradient-to-r from-red-50 to-pink-50 border-l-2 border-red-400' : 'hover:bg-red-50'"
            >
              <span class="w-2 h-2 rounded-full bg-red-500 shadow-sm"></span>
              ‰∏ç‰ºöÔºö{{ notLearnedCount }}
            </button>
            <button
              @click="filterType = 'vague'"
              class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium transition-all text-slate-600"
              :class="filterType === 'vague' ? 'bg-gradient-to-r from-amber-50 to-orange-50 border-l-2 border-amber-400' : 'hover:bg-amber-50'"
            >
              <span class="w-2 h-2 rounded-full bg-amber-500 shadow-sm"></span>
              Ê®°Á≥äÔºö{{ vagueCount }}
            </button>
            <button
              @click="filterType = 'mastered'"
              class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium transition-all text-slate-600"
              :class="filterType === 'mastered' ? 'bg-gradient-to-r from-emerald-50 to-green-50 border-l-2 border-emerald-400' : 'hover:bg-emerald-50'"
            >
              <span
                class="w-2 h-2 rounded-full bg-emerald-500 shadow-sm"
              ></span>
              ÊéåÊè°Ôºö{{ masteredCount }}
            </button>
          </div>
        </div>

        <!-- ÂçïËØçÂç°ÁâáÂàóË°® -->
        <div class="max-w-5xl mx-auto">
          <div class="space-y-3">
            <!-- Á©∫Áä∂ÊÄÅ -->
            <div
              v-if="currentPageWords.length === 0"
              class="bg-gradient-to-br from-white to-indigo-50 bg-opacity-20 rounded-xl px-8 py-16 text-center border-2 border-indigo-200 shadow-md"
            >
              <div class="text-5xl mb-4">üìñ</div>
              <h3
                class="text-xl font-semibold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2"
              >
                ÊöÇÊó†ÂçïËØç
              </h3>
              <p class="text-slate-500">ÂΩìÂâçÁ≠õÈÄâÊù°‰ª∂‰∏ãÊ≤°ÊúâÊâæÂà∞ÂçïËØç</p>
            </div>

            <!-- ÂΩìÂâçÈ°µÁöÑÂçïËØçÂç°Áâá -->
            <div
              v-for="(word, index) in currentPageWords"
              :key="word.id || index"
              @click="playWord(word.word)"
              class="bg-white rounded-xl px-4 sm:px-6 py-4 transition-all flex flex-col sm:flex-row sm:items-center gap-4 sm:gap-6 border-2 border-transparent hover:border-indigo-100 hover:shadow-xl shadow-sm"
            >
              <!-- ÂçïËØçÂç°ÁâáÂ∑¶‰æß -->
              <div class="flex-1 w-full">
                <div class="flex items-start sm:items-center gap-2 sm:gap-4">
                  <div class="flex-1 min-w-0">
                    <div class="space-y-1.5">
                      <div class="flex items-center gap-2 sm:gap-3 flex-wrap">
                        <!-- Êí≠ÊîæÂå∫Âüü -->
                        <button
                          @click.stop="playWord(word.word)"
                          class="flex items-center gap-1.5 sm:gap-2 group transition-all"
                          title="ÁÇπÂáªÊí≠ÊîæÂèëÈü≥"
                        >
                          <h2
                            class="text-base sm:text-lg font-semibold transition-colors"
                            :class="playingWord === word.word ? 'text-indigo-600' : 'text-gray-900 group-hover:text-indigo-600'"
                          >
                            {{ word.word }}
                          </h2>
                          <!-- Êí≠ÊîæÂõæÊ†á -->
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            class="w-3.5 h-3.5 sm:w-4 sm:h-4 transition-all group-hover:scale-110"
                            :class="playingWord === word.word ? 'text-indigo-600' : 'text-gray-400 group-hover:text-indigo-500'"
                          >
                            <path
                              d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"
                            />
                          </svg>
                        </button>
                        <span
                          v-if="word.pronunciation"
                          class="text-xs sm:text-sm text-indigo-700 font-mono bg-gradient-to-r from-indigo-50 to-purple-50 px-1.5 sm:px-2 py-0.5 rounded border border-indigo-100"
                        >
                          /{{ word.pronunciation }}/
                        </span>
                        <!-- ËØçÊÄßÊ†áÁ≠æ -->
                        <span
                          v-if="word.partOfSpeech"
                          class="text-xs font-bold px-2 py-0.5 rounded-md shadow-sm"
                          :class="{
                            'bg-blue-100 text-blue-700': word.partOfSpeech.includes('n.'),
                            'bg-green-100 text-green-700': word.partOfSpeech.includes('v.'),
                            'bg-purple-100 text-purple-700': word.partOfSpeech.includes('adj.'),
                            'bg-pink-100 text-pink-700': word.partOfSpeech.includes('adv.'),
                            'bg-amber-100 text-amber-700': word.partOfSpeech.includes('prep.'),
                            'bg-cyan-100 text-cyan-700': word.partOfSpeech.includes('pron.'),
                            'bg-indigo-100 text-indigo-700': word.partOfSpeech.includes('conj.'),
                            'bg-orange-100 text-orange-700': word.partOfSpeech.includes('art.'),
                            'bg-gray-100 text-gray-700': true
                          }"
                        >
                          {{ word.partOfSpeech }}
                        </span>
                        <span
                          v-if="word.meaning"
                          class="text-xs sm:text-sm text-slate-700 font-medium"
                        >
                          {{ word.meaning }}
                        </span>
                      </div>
                      <!-- ‰æãÂè• -->
                      <div
                        v-if="word.example || word.exampleTranslation"
                        class="flex items-center gap-2 flex-wrap"
                      >
                        <p
                          v-if="word.example"
                          @click.stop="playWord(word.example)"
                          class="text-xs sm:text-sm text-indigo-600 italic bg-indigo-50 rounded-md px-2.5 sm:px-3 py-1 sm:py-1.5 border-l-4 border-indigo-300 hover:bg-indigo-100 transition-colors cursor-pointer"
                        >
                          {{ word.example }}
                        </p>
                        <p
                          v-if="word.exampleTranslation"
                          class="text-xs sm:text-sm text-slate-600"
                        >
                          {{ word.exampleTranslation }}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ÈÄâÈ°πÊåâÈíÆÁªÑ -->
              <div
                class="flex gap-0 w-full sm:w-auto shrink-0 rounded overflow-hidden border-2 border-indigo-100 bg-white"
                @click.stop
              >
                <label
                  v-for="(level, i) in levels"
                  :key="level.value"
                  class="cursor-pointer flex-1 sm:flex-initial relative"
                >
                  <input
                    type="radio"
                    :name="`word-${word.id}`"
                    :value="level.value"
                    :checked="checkMastery(word.id, level.value)"
                    @change="updateWordMastery(word.id, level.value)"
                    class="peer sr-only"
                  />
                  <div
                    :class="[
                      'flex items-center justify-center px-2 sm:px-4 h-8 sm:h-9 text-xs font-medium relative',
                      level.class
                    ]"
                  >
                    <span
                      v-if="i > 0"
                      class="absolute left-0 top-1/2 -translate-y-1/2 h-3/4 w-px bg-indigo-200"
                    ></span>
                    {{ level.label }}
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- ÂàÜÈ°µÊéß‰ª∂ -->
          <div class="flex justify-center items-center gap-2 mt-10 mb-6">
            <button
              @click="goToPage(currentPage - 1)"
              :disabled="currentPage === 1"
              class="px-3 sm:px-4 py-2 rounded-lg bg-white text-slate-700 text-sm font-medium hover:bg-indigo-50 hover:border-indigo-300 transition-all disabled:opacity-30 disabled:cursor-not-allowed border border-slate-200 shadow-sm hover:shadow-md"
            >
              <span class="hidden sm:inline">‰∏ä‰∏ÄÈ°µ</span>
              <span class="sm:hidden">prev</span>
            </button>

            <div class="flex gap-1 hidden sm:flex">
              <button
                v-for="page in visiblePages"
                :key="page"
                @click="goToPage(page)"
                :class="[
                  'w-9 h-9 rounded-lg text-sm font-medium transition-all',
                  page === currentPage
                    ? 'bg-gradient-to-br from-indigo-600 to-purple-600 text-white shadow-lg hover:shadow-xl scale-105'
                    : 'bg-white text-slate-700 hover:bg-gradient-to-br hover:from-indigo-50 hover:to-purple-50 border border-slate-200 shadow-sm hover:shadow-md hover:border-indigo-300'
                ]"
              >
                {{ page }}
              </button>
            </div>

            <button
              @click="goToPage(currentPage + 1)"
              :disabled="currentPage === totalPages"
              class="px-3 sm:px-4 py-2 rounded-lg bg-white text-slate-700 text-sm font-medium hover:bg-indigo-50 hover:border-indigo-300 transition-all disabled:opacity-30 disabled:cursor-not-allowed border border-slate-200 shadow-sm hover:shadow-md"
            >
              <span class="hidden sm:inline">‰∏ã‰∏ÄÈ°µ</span>
              <span class="sm:hidden">next</span>
            </button>
          </div>

          <!-- ÂàÜÈ°µ‰ø°ÊÅØ -->
          <div
            class="text-center text-slate-600 text-xs sm:text-sm font-medium"
          >
            Á¨¨ {{ currentPage }} / {{ totalPages }} È°µ ¬∑ ÂÖ± {{ wordList.length
            }} ‰∏™ÂçïËØç
          </div>
        </div>
      </div>

      <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
      <style>
        @keyframes blob {
          0% {
            transform: translate(0px, 0px) scale(1);
          }
          33% {
            transform: translate(30px, -50px) scale(1.1);
          }
          66% {
            transform: translate(-20px, 20px) scale(0.9);
          }
          100% {
            transform: translate(0px, 0px) scale(1);
          }
        }
        .animate-blob {
          animation: blob 7s infinite;
          will-change: transform;
        }
        .animation-delay-2000 {
          animation-delay: 2s;
        }
        .animation-delay-3000 {
          animation-delay: 3s;
        }

        /* Ëá™ÂÆö‰πâselect‰∏ãÊãâÊ°ÜÁÆ≠Â§¥ */
        select {
          appearance: none;
          background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
          background-position: right 10px center;
          background-repeat: no-repeat;
          background-size: 1.25em 1.25em;
        }

        /* ÊÄßËÉΩ‰ºòÂåñÔºöÁ°¨‰ª∂Âä†ÈÄü */
        .transition-all,
        .group,
        button,
        select {
          transform: translateZ(0);
          backface-visibility: hidden;
          perspective: 1000px;
        }

        /* ‰ºòÂåñÂä®ÁîªÊÄßËÉΩ */
        @media (prefers-reduced-motion: reduce) {
          .animate-blob {
            animation: none;
          }
        }

        /* ÈöêËóèÊªöÂä®Êù° */
        .scrollbar-hide {
          -ms-overflow-style: none; /* IE Âíå Edge */
          scrollbar-width: none; /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none; /* Chrome, Safari, Opera */
        }

        /* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè */
        .overflow-y-auto::-webkit-scrollbar {
          width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
          background: linear-gradient(to bottom, #8b5cf6, #ec4899);
          border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(to bottom, #7c3aed, #db2777);
        }
      </style>
    </div>

    <script>
      const { createApp } = Vue;

      // ==================== ÈÖçÁΩÆÂ∏∏Èáè ====================
      const CONFIG = {
        WORDS_PER_PAGE: 20, // ÊØèÈ°µÊòæÁ§∫ÁöÑÂçïËØçÊï∞Èáè
        MAX_VISIBLE_PAGES: 5, // ÊúÄÂ§öÊòæÁ§∫ÁöÑÈ°µÁ†ÅÊï∞Èáè
      };

      // ËØçÊ±áË°®ÈÖçÁΩÆ
      const VOCABULARY_SETS = [
        {
          label: "üìö Âàù‰∏≠ËØçÊ±á",
          value: "middle-school",
          dataVar: "middleSchoolVocabulary", // ÂØπÂ∫îÁöÑÊï∞ÊçÆÂèòÈáèÂêç
        },
        {
          label: "üìñ È´ò‰∏≠ËØçÊ±á",
          value: "high-school",
          dataVar: "highSchoolVocabulary", // ÂêéÁª≠Ê∑ªÂä†
        },
        {
          label: "üéì Â§ßÂ≠¶ËØçÊ±á",
          value: "college",
          dataVar: "collegeVocabulary", // ÂêéÁª≠Ê∑ªÂä†
        },
        {
          label: "üìù ËÄÉÁ†îËØçÊ±á",
          value: "graduate",
          dataVar: "graduateVocabulary", // ÂêéÁª≠Ê∑ªÂä†
        },
      ];

      createApp({
        data() {
          return {
            wordList: [], // ÂçïËØçÂàóË°®
            loading: true, // Âä†ËΩΩÁä∂ÊÄÅ
            currentPage: 1, // ÂΩìÂâçÈ°µÁ†Å
            wordsPerPage: CONFIG.WORDS_PER_PAGE,
            filterType: "not-learned", // Á≠õÈÄâÁ±ªÂûãÔºàÈªòËÆ§ÊòæÁ§∫"‰∏ç‰ºö"Ôºâ
            wordMastery: {}, // Â≠òÂÇ®ÊØè‰∏™ÂçïËØçÁöÑÊéåÊè°Á®ãÂ∫¶
            currentVocabularySet: "middle-school", // ÂΩìÂâçËØçÊ±áË°®
            vocabularySets: VOCABULARY_SETS, // ËØçÊ±áË°®ÂàóË°®
            playingWord: null, // ÂΩìÂâçÊ≠£Âú®Êí≠ÊîæÁöÑÂçïËØç
            wordQueue: [], // Êí≠ÊîæÈòüÂàó
            isSticky: false, // ÊòØÂê¶Â§Ñ‰∫éÂê∏È°∂Áä∂ÊÄÅ
            // ÊéåÊè°Á®ãÂ∫¶ÈÄâÈ°πÈÖçÁΩÆ
            levels: [
              {
                label: "‰∏ç‰ºö",
                value: 0,
                class:
                  "text-red-600 hover:bg-red-50 peer-checked:bg-red-100 peer-checked:text-red-700",
              },
              {
                label: "Ê®°Á≥ä",
                value: 50,
                class:
                  "text-amber-600 hover:bg-amber-50 peer-checked:bg-amber-100 peer-checked:text-amber-700",
              },
              {
                label: "ÊéåÊè°",
                value: 100,
                class:
                  "text-emerald-600 hover:bg-emerald-50 peer-checked:bg-emerald-100 peer-checked:text-emerald-700",
              },
            ],
          };
        },

        computed: {
          // Ê†πÊçÆÁ≠õÈÄâÊù°‰ª∂ËøáÊª§ÂçïËØçÂàóË°®
          filteredWordList() {
            if (this.filterType === "all") {
              return this.wordList;
            }

            const filterValue = {
              "not-learned": 0,
              vague: 50,
              mastered: 100,
            }[this.filterType];

            return this.wordList.filter((word) => {
              const mastery = this.wordMastery[word.id];
              // Êú™Ê†áËÆ∞ÁöÑÂçïËØçÊàñÊú™ÂÆö‰πâÁöÑÂçïËØç
              if (mastery === undefined || mastery === null) {
                // Êú™ÈÄâÊã©ÁöÑÂçïËØçÊ†πÊçÆÁ≠õÈÄâÊù°‰ª∂ÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫
                return this.filterType === "not-learned";
              }
              return mastery === filterValue;
            });
          },

          // ËÆ°ÁÆóÊÄªÈ°µÊï∞
          totalPages() {
            return Math.ceil(this.filteredWordList.length / this.wordsPerPage);
          },

          // ËÆ°ÁÆóÂ∑≤ÂÆåÊàêÁöÑÂçïËØçÊï∞ÈáèÔºàÊ†áËÆ∞‰∏∫"Ê®°Á≥ä"Êàñ"ÊéåÊè°"ÁöÑÂçïËØçÔºâ
          completedWordsCount() {
            return Object.values(this.wordMastery).filter(
              (mastery) => mastery === 50 || mastery === 100
            ).length;
          },

          // ËÆ°ÁÆó"‰∏ç‰ºö"ÁöÑÂçïËØçÊï∞ÈáèÔºàÊú™Ê†áËÆ∞ÁöÑÂçïËØçÈªòËÆ§ËßÜ‰∏∫"‰∏ç‰ºö"Ôºâ
          notLearnedCount() {
            const markedAsNotLearned = Object.values(this.wordMastery).filter(
              (mastery) => mastery === 0
            ).length;
            const unmarked =
              this.wordList.length - Object.keys(this.wordMastery).length;
            return markedAsNotLearned + unmarked;
          },

          // ËÆ°ÁÆó"Ê®°Á≥ä"ÁöÑÂçïËØçÊï∞Èáè
          vagueCount() {
            return Object.values(this.wordMastery).filter(
              (mastery) => mastery === 50
            ).length;
          },

          // ËÆ°ÁÆó"ÊéåÊè°"ÁöÑÂçïËØçÊï∞Èáè
          masteredCount() {
            return Object.values(this.wordMastery).filter(
              (mastery) => mastery === 100
            ).length;
          },

          // Ëé∑ÂèñÂΩìÂâçÈ°µÁöÑÂçïËØçÂàóË°®
          currentPageWords() {
            const start = (this.currentPage - 1) * this.wordsPerPage;
            const end = start + this.wordsPerPage;
            return this.filteredWordList.slice(start, end);
          },

          // ËÆ°ÁÆóÂèØËßÅÁöÑÈ°µÁ†ÅÊåâÈíÆ
          visiblePages() {
            const total = this.totalPages;
            const current = this.currentPage;
            const maxVisible = CONFIG.MAX_VISIBLE_PAGES;

            if (total <= maxVisible) {
              // Â¶ÇÊûúÊÄªÈ°µÊï∞Â∞è‰∫éÁ≠â‰∫éÊúÄÂ§ßÊòæÁ§∫È°µÊï∞ÔºåÊòæÁ§∫ÊâÄÊúâÈ°µÁ†Å
              return Array.from({ length: total }, (_, i) => i + 1);
            }

            // ËÆ°ÁÆóËµ∑ÂßãÂíåÁªìÊùüÈ°µÁ†Å
            let start = Math.max(1, current - Math.floor(maxVisible / 2));
            let end = Math.min(total, start + maxVisible - 1);

            // Ë∞ÉÊï¥Ëµ∑ÂßãÈ°µÁ†ÅÔºåÁ°Æ‰øùÊòæÁ§∫Âõ∫ÂÆöÊï∞ÈáèÁöÑÈ°µÁ†Å
            if (end - start + 1 < maxVisible) {
              start = Math.max(1, end - maxVisible + 1);
            }

            return Array.from({ length: end - start + 1 }, (_, i) => start + i);
          },
        },

        methods: {
          /**
           * Ê£ÄÊü•ÂçïËØçÁöÑÊéåÊè°Á®ãÂ∫¶
           * @param {String} wordId - ÂçïËØçID
           * @param {Number} mastery - ÊéåÊè°Á®ãÂ∫¶ÂÄº
           * @returns {Boolean} ÊòØÂê¶ÂåπÈÖç
           */
          checkMastery(wordId, mastery) {
            const wordMasteryValue = this.wordMastery[wordId];
            // Â¶ÇÊûúÂçïËØçÊú™Ê†áËÆ∞Ôºàundefined Êàñ nullÔºâ‰∏îÊ£ÄÊü•ÁöÑÊòØ"‰∏ç‰ºö"Áä∂ÊÄÅÔºåËøîÂõûtrue
            if (
              (wordMasteryValue === undefined || wordMasteryValue === null) &&
              mastery === 0
            ) {
              return true;
            }
            return wordMasteryValue === mastery;
          },

          /**
           * Êõ¥Êñ∞ÂçïËØçÊéåÊè°Á®ãÂ∫¶
           * @param {String} wordId - ÂçïËØçID
           * @param {Number} mastery - ÊéåÊè°Á®ãÂ∫¶ÂÄº
           */
          updateWordMastery(wordId, mastery) {
            if (mastery === 0) {
              // Â¶ÇÊûúÈÄâÊã©"‰∏ç‰ºö"ÔºåÂàôÂà†Èô§ËØ•ÂçïËØçÁöÑÁä∂ÊÄÅÔºàÈªòËÆ§‰∏∫‰∏ç‰ºöÔºâ
              delete this.wordMastery[wordId];
            } else {
              // ÂÖ∂‰ªñÁä∂ÊÄÅ‰øùÂ≠ò
              this.wordMastery[wordId] = mastery;
            }
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            this.saveWordMastery();
          },

          /**
           * ‰øùÂ≠òÂçïËØçÊéåÊè°Á®ãÂ∫¶Âà∞Êú¨Âú∞Â≠òÂÇ®ÔºàËäÇÊµÅ‰ºòÂåñÔºâ
           */
          saveWordMastery() {
            // ‰ΩøÁî®ËäÇÊµÅÔºåÂáèÂ∞ëÂÜôÂÖ•È¢ëÁéá
            if (this.saveTimer) {
              clearTimeout(this.saveTimer);
            }
            this.saveTimer = setTimeout(() => {
              try {
                const key = `wordMastery_${this.currentVocabularySet}`;
                localStorage.setItem(key, JSON.stringify(this.wordMastery));
              } catch (error) {
                console.error("‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:", error);
              }
              this.saveTimer = null;
            }, 500);
          },

          /**
           * ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÂçïËØçÊéåÊè°Á®ãÂ∫¶
           */
          loadWordMastery() {
            try {
              const key = `wordMastery_${this.currentVocabularySet}`;
              const saved = localStorage.getItem(key);
              if (saved) {
                this.wordMastery = JSON.parse(saved);
                console.log("‚úÖ Â∑≤Âä†ËΩΩ‰øùÂ≠òÁöÑÂçïËØçÁä∂ÊÄÅ");
              } else {
                // Â¶ÇÊûúÊú¨Âú∞Ê≤°Êúâ‰øùÂ≠òÁöÑÁä∂ÊÄÅÔºåÂàùÂßãÂåñ‰∏∫Á©∫ÂØπË±°ÔºàÊâÄÊúâÂçïËØçÈªòËÆ§"‰∏ç‰ºö"Ôºâ
                this.wordMastery = {};
              }
            } catch (error) {
              console.error("Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:", error);
              this.wordMastery = {};
            }
          },

          /**
           * ÂàáÊç¢ËØçÊ±áË°®
           */
          async switchVocabularySet() {
            // ÈáçÁΩÆÈ°µÁ†ÅÂíåÁ≠õÈÄâ
            this.currentPage = 1;
            this.filterType = "not-learned";
            // Ê∏ÖÁ©∫ÂΩìÂâçÁä∂ÊÄÅ
            this.wordMastery = {};
            // Âä†ËΩΩÊñ∞ËØçÊ±áË°®ÔºàÁ≠âÂæÖÂÆåÊàêÔºâ
            await this.loadVocabulary();
            // Âä†ËΩΩÊñ∞ËØçÊ±áË°®ÁöÑÁä∂ÊÄÅ
            this.loadWordMastery();
          },

          /**
           * Ë∑≥ËΩ¨Âà∞ÊåáÂÆöÈ°µÈù¢
           * @param {Number} page - ÁõÆÊ†áÈ°µÁ†Å
           */
          goToPage(page) {
            if (page >= 1 && page <= this.totalPages) {
              this.currentPage = page;
              // ÊªöÂä®Âà∞È°∂ÈÉ®
              window.scrollTo({ top: 0, behavior: "smooth" });
            }
          },

          /**
           * Ëé∑ÂèñÂÖ®Â±ÄÁ¥¢ÂºïÔºàË∑®È°µÈù¢ÁöÑÂ∫èÂè∑Ôºâ
           * @param {Number} index - ÂΩìÂâçÈ°µÈù¢ÁöÑÁ¥¢Âºï
           * @returns {Number} ÂÖ®Â±ÄÁ¥¢Âºï
           */
          getGlobalIndex(index) {
            return (this.currentPage - 1) * this.wordsPerPage + index + 1;
          },

          /**
           * Êí≠ÊîæÂçïËØçÂèëÈü≥
           * @param {String} word - Ë¶ÅÊí≠ÊîæÁöÑÂçïËØç
           */
          playWord(word) {
            if ("speechSynthesis" in window) {
              // Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®Êí≠ÊîæÔºåÂ∞ÜÊñ∞ÂçïËØçÂä†ÂÖ•ÈòüÂàó
              if (window.speechSynthesis.speaking && this.playingWord) {
                // Â¶ÇÊûúÈòüÂàó‰∏≠Ê≤°Êúâ‰∏î‰∏çÊòØÂΩìÂâçÊí≠ÊîæÁöÑÂçïËØçÔºåÂä†ÂÖ•ÈòüÂàó
                if (
                  !this.wordQueue.includes(word) &&
                  this.playingWord !== word
                ) {
                  this.wordQueue.push(word);
                }
                return;
              }

              // Â¶ÇÊûúÊ≤°ÊúâÊ≠£Âú®Êí≠ÊîæÔºåÂºÄÂßãÊí≠Êîæ
              this.startPlaying(word);
            } else {
              // Â¶ÇÊûúÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂêàÊàêAPIÔºåÊòæÁ§∫ÊèêÁ§∫
              alert("ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥Êí≠ÊîæÂäüËÉΩ");
            }
          },

          /**
           * ÂºÄÂßãÊí≠ÊîæÂçïËØç
           * @param {String} word - Ë¶ÅÊí≠ÊîæÁöÑÂçïËØç
           */
          startPlaying(word) {
            // ËÆæÁΩÆÂΩìÂâçÊí≠ÊîæÁöÑÂçïËØçÔºàÊòæÁ§∫Êí≠ÊîæÂä®ÁîªÔºâ
            this.playingWord = word;

            // ÂàõÂª∫Êñ∞ÁöÑËØ≠Èü≥ÂêàÊàê
            const utterance = new SpeechSynthesisUtterance(word);

            // ËÆæÁΩÆÂèëÈü≥ÂèÇÊï∞
            utterance.lang = "en-US"; // ËÆæÁΩÆ‰∏∫ÁæéÂºèËã±ËØ≠
            utterance.rate = 1.0; // Êí≠ÊîæÈÄüÂ∫¶
            utterance.pitch = 1.0; // Èü≥Ë∞É
            utterance.volume = 1.0; // Èü≥Èáè

            // Êí≠ÊîæÂÆåÊàêÂêéÂ§ÑÁêÜ
            utterance.onend = () => {
              if (this.playingWord === word) {
                this.playingWord = null;
                // Êí≠Êîæ‰∏ã‰∏Ä‰∏™ÈòüÂàó‰∏≠ÁöÑÂçïËØç
                if (this.wordQueue.length > 0) {
                  const nextWord = this.wordQueue.shift();
                  this.$nextTick(() => {
                    this.startPlaying(nextWord);
                  });
                }
              }
            };

            // Êí≠ÊîæÂá∫ÈîôÊó∂‰πüÊ∏ÖÈô§Áä∂ÊÄÅ
            utterance.onerror = () => {
              this.playingWord = null;
              // Â¶ÇÊûúÈòüÂàó‰∏≠ËøòÊúâÂçïËØçÔºåÁªßÁª≠Êí≠Êîæ
              if (this.wordQueue.length > 0) {
                const nextWord = this.wordQueue.shift();
                this.$nextTick(() => {
                  this.startPlaying(nextWord);
                });
              }
            };

            // Êí≠ÊîæÈü≥È¢ë
            window.speechSynthesis.speak(utterance);
          },

          /**
           * ÂàùÂßãÂåñÊï∞ÊçÆÂä†ËΩΩ
           */
          async loadVocabulary() {
            try {
              // Ëé∑ÂèñÂΩìÂâçËØçÊ±áË°®ÁöÑÈÖçÁΩÆ
              const currentSet = this.vocabularySets.find(
                (set) => set.value === this.currentVocabularySet
              );

              if (!currentSet || !currentSet.dataVar) {
                console.warn("ÂΩìÂâçËØçÊ±áË°®Êú™ÈÖçÁΩÆÊï∞ÊçÆÊ∫ê");
                this.wordList = this.getDefaultWords();
                return;
              }

              // Ê†πÊçÆdataVarÂä†ËΩΩÂØπÂ∫îÁöÑÊï∞ÊçÆ
              if (typeof window[currentSet.dataVar] === "undefined") {
                throw new Error(
                  `ËØçÊ±áÊï∞ÊçÆÊú™ÂÆö‰πâ: ${currentSet.dataVar} for ${currentSet.label}`
                );
              }

              this.wordList = window[currentSet.dataVar];
              console.log(
                `‚úÖ ÊàêÂäüÂä†ËΩΩ ${this.wordList.length} ‰∏™ÂçïËØç (${currentSet.label})`
              );
              console.log("üìù ËØçÊ±áÂàóË°®Á§∫‰æã:", this.wordList.slice(0, 3));
            } catch (error) {
              console.error("‚ùå Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:", error);
              this.wordList = this.getDefaultWords();
            } finally {
              this.loading = false;
            }
          },

          /**
           * Ëé∑ÂèñÈªòËÆ§Á§∫‰æãÂçïËØç
           * @returns {Array} Á§∫‰æãÂçïËØçÊï∞ÁªÑ
           */
          getDefaultWords() {
            return [];
          },

          /**
           * Â§ÑÁêÜÊªöÂä®‰∫ã‰ª∂ÔºåÊ£ÄÊµãÊòØÂê¶Âê∏È°∂ÔºàÂ∏¶Èò≤Êäñ‰ºòÂåñÔºâ
           */
          handleScroll() {
            const header = document.querySelector(".sticky");
            if (header) {
              const rect = header.getBoundingClientRect();
              this.isSticky = rect.top <= 0; // ÂΩìÂê∏È°∂Êó∂
            }
          },

          /**
           * Èò≤ÊäñÂáΩÊï∞
           */
          debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
              const later = () => {
                clearTimeout(timeout);
                func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
            };
          },
        },

        watch: {
          // ÁõëÂê¨Á≠õÈÄâÁ±ªÂûãÂèòÂåñÔºåÈáçÁΩÆÈ°µÁ†Å
          filterType() {
            this.currentPage = 1;
          },
        },

        // ÁªÑ‰ª∂ÊåÇËΩΩÂêéÂä†ËΩΩÊï∞ÊçÆ
        async mounted() {
          // ÂÖàÂàùÂßãÂåñwordMastery
          this.wordMastery = {};
          // Âä†ËΩΩËØçÊ±áÊï∞ÊçÆ
          await this.loadVocabulary();
          // Âä†ËΩΩ‰øùÂ≠òÁöÑÁä∂ÊÄÅÔºà‰ºöË¶ÜÁõñÈªòËÆ§ÁöÑÁ©∫ÂØπË±°Ôºâ
          this.loadWordMastery();
          // Ê∑ªÂä†ÊªöÂä®ÁõëÂê¨Ôºà‰ΩøÁî®Èò≤Êäñ‰ºòÂåñÊÄßËÉΩÔºâ
          this.debouncedHandleScroll = this.debounce(this.handleScroll, 10);
          window.addEventListener("scroll", this.debouncedHandleScroll);
        },

        // ÁªÑ‰ª∂Âç∏ËΩΩÂâçÊ∏ÖÁêÜ
        beforeUnmount() {
          if (this.debouncedHandleScroll) {
            window.removeEventListener("scroll", this.debouncedHandleScroll);
          }
          // Ê∏ÖÁêÜ‰øùÂ≠òËÆ°Êó∂Âô®
          if (this.saveTimer) {
            clearTimeout(this.saveTimer);
          }
        },
      }).mount("#app");
    </script>
  </body>
</html>
